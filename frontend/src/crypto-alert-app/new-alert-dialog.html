<link rel="import" href="../../bower_components/paper-item/paper-item.html"/>
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"/>
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html"/>
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html"/>
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html"/>

<link rel="import" href="alert-form-behavior.html"/>
<link rel="import" href="form-element-behavior.html"/>
<link rel="import" href="single-currency-form.html"/>
<link rel="import" href="periodic-notifications-form.html"/>

<dom-module id="new-alert-dialog">
  <template>
    <style>
      :host {
        @apply --layout-vertical;
      }

      #dialog {
        margin: 0;
      }

      app-toolbar {
        @apply --layout-flex;
        font-size: 15px;
        background-color: rgba(246, 242, 253, 0.51);
        max-height: 30px;
        margin-top: 0;
        padding-left: 0;
      }

      .spacer {
        min-width: 20px;
      }

      paper-item {
        cursor: pointer;
      }

      .buttons {
        @apply --layout-flex;
      }

      .first {
        @apply --layout-vertical;
        margin-top: 15px;
      }
    </style>

    <paper-dialog id="dialog"
                  always-on-top
                  entry-animation="scale-up-animation"
                  exit-animation="fade-out-animation"
                  on-iron-overlay-closed=_clearForms
                  no-cancel-on-outside-click>

      <app-toolbar>
        <paper-icon-button
                noink
                icon="chevron-left"
                hidden$="[[_isFormSelection]]"
                on-tap=_backToFormSelection></paper-icon-button>
        <div class="spacer"></div>
        <div main-title>New alert</div>
      </app-toolbar>

      <iron-pages id="pages1" selected="0">

        <iron-selector id="buttons" class="buttons first" attr-for-selected="form" on-selected-changed=_viewForm>
          <paper-item form="single">Follow one currency</paper-item>
          <paper-item form="periodic">Periodic updates</paper-item>
        </iron-selector>

        <iron-pages id="pages2" attr-for-selected="id">
          <periodic-notifications-form id="periodic"></periodic-notifications-form>
          <single-currency-form id="single"></single-currency-form>
        </iron-pages>

      </iron-pages>

    </paper-dialog>

  </template>

  <script>
      class NewAlertDialog extends Polymer.Element {
          static get is() {
              return 'new-alert-dialog';
          }

          static get properties() {
              return {
                  _isFormSelection: {
                      type: Boolean,
                      value: true
                  }
              }
          }

          open() {
              this.$.buttons.select();
              setTimeout(() => this.$.dialog.open());
          }

          close() {
              this.$.dialog.close();
          }

          _backToFormSelection() {
              this.set('_isFormSelection', true);
              this.$.buttons.select();
              this._selectPagesAndFit(0, 'single');
          }

          _selectPagesAndFit(pageNo, formId) {
              this.$.pages1.select(pageNo);
              this.$.pages2.select(formId);

              setTimeout(() => {
                  this.$.dialog.resetFit();
                  this.$.dialog.center();
              });
          }

          _viewForm(e) {
              this.set('_isFormSelection', false);
              this._selectPagesAndFit(1, e.detail.value);
              e.stopPropagation();
          }

          _clearForms(e) {
              if (e.target === this.$.dialog) {
                  this._backToFormSelection();
                  this.$.single.clearForm();
                  this.$.periodic.clearForm();
              }
          }
      }

      window.customElements.define('new-alert-dialog', NewAlertDialog);
  </script>
</dom-module>