<link rel="import" href="../../bower_components/paper-item/paper-item.html"/>
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html"/>
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html"/>
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html"/>

<link rel="import" href="alert-form-behavior.html"/>
<link rel="import" href="currencies-menu.html"/>
<link rel="import" href="radio-menu.html"/>


<dom-module id="new-alert-dialog">
  <template>
    <style>
      :host {
        @apply --layout-vertical;
      }

      #dialog {
        margin: 0;
      }

      app-toolbar {
        @apply --layout-flex;
        font-size: 15px;
        background-color: rgba(246, 242, 253, 0.51);
        max-height: 30px;
        margin-top: 0;
      }

      iron-form {
        margin: 0;
      }

      form {
        @apply --layout-flex;
      }

      #inputs {
        @apply --layout-flex-4;
        @apply --layout-between-aligned;
        @apply --layout-horizontal;
      }

      .input {
        @apply --layout-flex;
        max-width: 10em;
      }

      #goes {
        margin-left: 15px;
      }

      .text {
        @apply --layout-vertical;
        @apply --layout-center-justified;
        @apply --paper-font-common-nowrap;
        margin-top: 17px;
        padding: 0;
        text-align: center;
      }

      .spacer {
        @apply --layout-flex;
        max-width: 10px;
      }

      #buttons {
        @apply --layout-flex;
        @apply --layout-horizontal;
        margin-top: 15px;
      }
    </style>

    <paper-dialog id="dialog"
                  always-on-top
                  entry-animation="scale-up-animation"
                  exit-animation="fade-out-animation"
                  on-iron-overlay-closed=_clearForm
                  no-cancel-on-outside-click>

      <app-toolbar>
        <div main-title>New alert</div>
      </app-toolbar>

      <iron-form id="form">
        <form>

          <div id="inputs">

            <div class="text">Alert me when :</div>
            <div class="spacer"></div>

            <currencies-menu id="currency" class="input" value="[[_currency]]" required></currencies-menu>

            <div class="spacer"></div>
            <div id="goes" class="text">goes</div>
            <div class="spacer"></div>

            <radio-menu id="radio" class="input" value="[[_radio]]" required></radio-menu>

            <div class="spacer"></div>

            <paper-input
                    id="value"
                    class="input"
                    name="value"
                    required
                    label="value"
                    pattern="^[0-9]+(?:[\.,][0-9]+)?$"
                    error-message="Should be a number"
                    on-value-changed="_validateInput">
            </paper-input>

          </div>

          <div id="buttons">
            <paper-button dialog-dismiss>Cancel</paper-button>
            <paper-button autofocus on-tap=_validateForm>Add</paper-button>
          </div>

        </form>
      </iron-form>

    </paper-dialog>

  </template>

  <script>
      class NewAlertDialog extends Polymer.Element {
          static get is() {
              return 'new-alert-dialog';
          }

          open() {
              this.$.dialog.open();
          }

          close() {
              this.$.dialog.close();
          }

          _validateForm() {
              const form = this.$.form;

              if (form.validate()) {
                  this.dispatchEvent(new CustomEvent('new-alert', {
                      detail: {
                          kicked: true,
                          body: form.serializeForm()
                      }
                  }));
              }
          }

          _validateInput(e) {
              const target = e.target;

              if (target.value === "") {
                  target.invalid = false;
              } else {
                  target.validate();
              }
          }

          _clearForm(e) {
              if (e.target === this.$.dialog) {
                  this.$.currency.clear();
                  this.$.radio.clear();
                  this.$.value.updateValueAndPreserveCaret('');
              }
          }
      }

      window.customElements.define('new-alert-dialog', NewAlertDialog);
  </script>
</dom-module>